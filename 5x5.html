<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mondrian Puzzle (5x5)</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");

      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        font-family: "Poppins", sans-serif;
      }

      h1 {
        position: absolute;
        top: 0;
      }

      .area {
        display: flex;
      }

      .play-area {
        position: relative;
        width: 500px;
        height: 500px;
        border: 2px solid #000;
        margin-right: 20px;
      }

      #initial-area {
        position: relative;
        width: 600px;
        height: 500px;
        border: 2px solid #000;
        margin-right: 20px;
      }

      .block {
        position: absolute;
        border: 2px solid #000;
      }

      .material-symbols-outlined {
        position: absolute;
        top: 0;
        left: 0;
        margin: 10px;
        scale: 2;
      }

      a {
        color: #000;
      }
    </style>
  </head>
  <body>
    <a href="/index.html"
      ><span class="material-symbols-outlined"> chevron_left </span></a
    >
    <h1>5x5</h1>
    <div class="area">
      <div
        class="play-area"
        id="initial-area"
        ondrop="drop(event, 'initial-area')"
        ondragover="allowDrop(event)"
      ></div>
      <div
        class="play-area"
        id="play-area"
        ondrop="drop(event, 'play-area')"
        ondragover="allowDrop(event)"
      ></div>
    </div>

    <script>
      let draggedElement = null;
      let placedBlocks = [];

      function allowDrop(event) {
        event.preventDefault();
      }

      function drag(event) {
        draggedElement = event.target;
        event.dataTransfer.setData("text", event.target.id);
      }

      function drop(event, areaId) {
        event.preventDefault();
        const data = event.dataTransfer.getData("text");
        const droppedElement = document.getElementById(data);

        const targetArea = document.getElementById(areaId);
        const rect = targetArea.getBoundingClientRect();

        const offsetX = event.clientX - rect.left;
        const offsetY = event.clientY - rect.top;

        const closestPosition = getClosestPosition(offsetX, offsetY, areaId);
        droppedElement.style.left = `${closestPosition.x}px`;
        droppedElement.style.top = `${closestPosition.y}px`;

        if (areaId === "play-area") {
          document.getElementById(areaId).appendChild(droppedElement);
          placedBlocks.push(areaId);
        }

        checkWin();
      }

      function generateBlock(id, width, height, x, y, areaId) {
        const block = document.createElement("div");
        block.className = "block";
        block.id = id;
        block.style.width = `${width}px`;
        block.style.height = `${height}px`;
        block.style.backgroundColor = getRandomColor();
        block.style.left = `${x}px`;
        block.style.top = `${y}px`;
        block.draggable = true;
        document.getElementById(areaId).appendChild(block);
        if (areaId === "play-area") {
          block.style.backgroundColor = "black";
          block.draggable = false;
        } else {
          block.addEventListener("dragstart", drag);
          block.addEventListener("click", () => changeSize(block, areaId));
        }
      }

      function changeSize(block, areaId) {
        const currentWidth = parseInt(block.style.width) || 0;
        const currentHeight = parseInt(block.style.height) || 0;

        block.style.height = `${currentWidth}px`;
        block.style.width = `${currentHeight}px`;
      }

      function getRandomColor() {
        const letters = "0123456789ABCDEF";
        let color = "#";
        for (let i = 0; i < 6; i++) {
          color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
      }

      generateBlock("block1", 100, 500, 0, 0, "initial-area");
      generateBlock("block2", 100, 400, 100, 0, "initial-area");
      generateBlock("block3", 100, 200, 400, 0, "initial-area");
      generateBlock("block4", 200, 200, 200, 0, "initial-area");
      generateBlock("block5", 100, 300, 200, 200, "initial-area");
      generateBlock("block6", 100, 300, 300, 200, "initial-area");
      generateBlock("block7", 100, 200, 100, 200, "play-area");
      generateBlock("block8", 100, 100, 200, 200, "play-area");
      generateBlock("block9", 100, 100, 0, 300, "play-area");

      function getClosestPosition(x, y, areaId) {
        const predefinedPositions = [
          { x: 0, y: 0 },
          { x: 100, y: 0 },
          { x: 200, y: 0 },
          { x: 300, y: 0 },
          { x: 400, y: 0 },
          { x: 0, y: 100 },
          { x: 100, y: 100 },
          { x: 200, y: 100 },
          { x: 300, y: 100 },
          { x: 400, y: 100 },
          { x: 0, y: 200 },
          { x: 300, y: 200 },
          { x: 400, y: 200 },
          { x: 200, y: 300 },
          { x: 300, y: 300 },
          { x: 400, y: 300 },
          { x: 0, y: 400 },
          { x: 100, y: 400 },
          { x: 200, y: 400 },
          { x: 300, y: 400 },
          { x: 400, y: 400 },
        ];

        let closestPosition = predefinedPositions[0];
        let shortestDistance = distance(
          x,
          y,
          closestPosition.x,
          closestPosition.y
        );

        for (const position of predefinedPositions) {
          const dist = distance(x, y, position.x, position.y);
          if (dist < shortestDistance) {
            shortestDistance = dist;
            closestPosition = position;
          }
        }

        return closestPosition;
      }

      function distance(x1, y1, x2, y2) {
        return Math.sqrt((x1 - x2) ** 2 + (y1 - y2) ** 2);
      }
    </script>
  </body>
</html>
